<!-- index.wxml -->
<!-- <page-meta>
  <navigation-bar title="å¾€æ¥è´ºå¡" back="{{false}}" color="black" background="#FFF"></navigation-bar>
</page-meta> -->
<view class="custom-header">
  <view class="header-content">
    <!-- æ¬¢è¿è¯­ -->
    <view class="welcome">Welcome ğŸ‘‹</view>
    <!-- æœç´¢æ¡† -->
    <view class="search-box">
      <icon type="search" size="14"></icon>
      <input type="text" placeholder="æ–°å¹´ç¥ç¦ã€çºªå¿µæ—¥ã€ç»“å©šã€ç”Ÿæ—¥ã€ç”Ÿæ„ç¥è´º..." placeholder-class="placeholder" bindinput="onSearchInput" value="{{searchKey}}" />
    </view>
  </view>
</view>
<view class="container">
  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <scroll-view scroll-x class="category-tabs">
    <view class="tab-item {{currentCategory === 'all' ? 'active' : ''}}" bindtap="handleCategoryChange" data-category="all">
      å…¨éƒ¨
    </view>
    <view class="tab-item {{currentCategory === item._id ? 'active' : ''}}" wx:for="{{categories}}" wx:key="_id" bindtap="handleCategoryChange" data-category="{{item._id}}">
      {{item.name}}
    </view>
  </scroll-view>
  <!-- å¡ç‰‡åˆ—è¡¨åŒºåŸŸ -->
  <scroll-view scroll-y class="cards-container">
    <!-- éª¨æ¶å± -->
    <view class="skeleton" wx:if="{{loading}}">
      <van-skeleton title row="6" />
    </view>
    <!-- çƒ­é—¨è´ºå¡ -->
    <view class="section" wx:if="{{currentCategory === 'all' && !loading}}">
      <view class="section-header">
        <text>çƒ­é—¨è´ºå¡</text>
        <view class="see-all" bindtap="navigateToCardList" data-type="hot" data-name="çƒ­é—¨è´ºå¡">
          æŸ¥çœ‹æ‰€æœ‰
          <text class="iconfont icon-youjiantou"></text>
        </view>
      </view>
      <scroll-view scroll-x class="cards-row">
        <view class="card-item" wx:for="{{hotCards}}" wx:key="_id">
          <view class="fold"></view>
          <image lazy-load src="{{item.coverUrl}}" mode="aspectFill" bindtap="handleOpenDialog" data-item="{{item}}" data-_id="{{item._id}}" />
          <view class="like-btn" catchtap="handleLike" data-id="{{item._id}}">
            <text class="iconfont icon-likefill {{item.isLiked ? 'like-btn--active' : ''}}" wx:if="{{item.isLiked}}"></text>
            <text class="iconfont icon-like" wx:else></text>
            <!-- <text class="like-count">{{item.likeCount}}</text> -->
          </view>
          <view class="vip-tag" wx:if="{{item.isVIP}}">
            <text class="iconfont icon-vip"></text>
          </view>
        </view>
      </scroll-view>
    </view>
    <!-- åˆ†ç±»è´ºå¡ -->
    <view class="section" wx:for="{{categories}}" wx:key="_id" wx:if="{{currentCategory === 'all' || currentCategory === item._id}}">
      <view class="section-header">
        <text>{{item.name}}</text>
        <view class="see-all" bindtap="navigateToCardList" data-type="{{item._id}}" data-name="{{item.name}}">
          æŸ¥çœ‹æ‰€æœ‰
          <text class="iconfont icon-youjiantou"></text>
        </view>
      </view>
      <scroll-view scroll-x class="cards-row">
        <view class="card-item" wx:for="{{categoryCards[item.name]}}" wx:key="_id" wx:for-item="card">
          <view class="fold"></view>
          <image lazy-load src="{{card.coverUrl}}" mode="aspectFill" bindtap="handleOpenDialog" data-item="{{card}}" data-_id="{{card._id}}" />
          <view class="like-btn" catchtap="handleLike" data-id="{{card._id}}">
            <text class="iconfont icon-likefill {{card.isLiked ? 'like-btn--active' : ''}}" wx:if="{{card.isLiked}}"></text>
            <text class="iconfont icon-like" wx:else></text>
            <!-- <text class="like-count">{{item.likeCount}}</text> -->
          </view>
          <view class="vip-tag" wx:if="{{card.isVIP}}">
            <text class="iconfont icon-vip"></text>
          </view>
        </view>
      </scroll-view>
    </view>
  </scroll-view>
  <!-- åº•éƒ¨å¯¼èˆªæ  -->
  <view class="tab-bar safe-area-bottom">
    <view class="tab-item active" bindtap="handleTabBar" data-type="home">
      <text class="iconfont icon-heqia"></text>
      <text>è´ºå¡</text>
    </view>
    <view class="tab-item" bindtap="handleTabBar" data-type="favorite">
      <text class="iconfont icon-shoucang"></text>
      <text>æˆ‘çš„æ”¶è—</text>
    </view>
    <view class="tab-item" bindtap="handleTabBar" data-type="sendCard">
      <text class="iconfont icon-fasong"></text>
      <text>å‘å‡ºçš„è´ºå¡</text>
    </view>
    <view class="tab-item" bindtap="handleTabBar" data-type="person">
      <text class="iconfont icon-geren"></text>
      <text>ä¸ªäººä¸»é¡µ</text>
    </view>
  </view>
</view>
<view class="dialog__overlay" wx:if="{{show}}"></view>
<van-dialog custom-class="my-dialog" overlay="{{false}}" width="280" use-slot show="{{ show }}" showConfirmButton="{{false}}">
  <view class="dialog__img">
    <image class="dialog__img--main" src="{{imageUrl}}" mode="aspectFill" />
    <image class="dialog__img--sub" src="../../images/common/card-bottom.png" />
    <view class="dialog__img--btn">æ‹†</view>
  </view>
  <view class="dialog__btn">
    <van-button custom-class="dialog__btn--use" color="#fb674d" bindtap="handleGoUse">
      å»ä½¿ç”¨
    </van-button>
    <icon type="cancel" size="30" color="#c79958" bindtap="handleColseDialog"></icon>
  </view>
</van-dialog>
<van-action-sheet show="{{ openProcessShow }}" title="å…è´¹è·å¾—VIPä¼šå‘˜" bind:close="handleOpenProcessCancel">
  <open-process bind:close="onCloseOpenProcess"></open-process>
</van-action-sheet>